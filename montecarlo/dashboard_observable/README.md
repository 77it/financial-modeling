# Monte Carlo Simulation Dashboard

An interactive dashboard built with [Observable Framework](https://observablehq.com/framework/) for visualizing Monte Carlo simulation results for financial projections.

---

# Features

- **Cash Flow Risk Analysis**: Interactive fan charts showing probability distributions of revenue, EBITDA, and net income
- **Sensitivity Analysis**: Tornado charts and time-series visualizations showing which variables drive output variance
- **Real-time Interactivity**: Adjust parameters and see results update instantly
- **Build-time Data Processing**: Data loaders process CSV files during build, generating static HTML/JS/CSS files
- **Static Output**: No server required - can deploy to any static hosting (GitHub Pages, Netlify, Vercel, S3, etc.)
- **Fast Loading**: Pre-processed data means instant page loads

---

# Running the Dashboard

## Prerequisites

- Node.js 18 or later

## Development Server

Start the development server with live reload:

```bash
npm run dev
```

Open your browser to http://localhost:3000

## Production Build

Build the static site for deployment:

```bash
npm run build
```

The built site will be in the `dist/` folder, ready for deployment.

---

# Distributing the Dashboard

## Deployment Options

The dashboard generates **static HTML/CSS/JS files** that can be deployed to any static hosting service:

**Free Hosting Options:**
- **GitHub Pages**: Push `dist/` folder to `gh-pages` branch
- **Netlify**: Drag and drop `dist/` folder or connect to Git repository
- **Vercel**: Import project and set build command to `npm run build`
- **Cloudflare Pages**: Connect repository and deploy

**Cloud Storage:**
- **AWS S3**: Upload `dist/` folder and enable static website hosting
- **Azure Static Web Apps**: Deploy via Azure Portal or CLI
- **Google Cloud Storage**: Upload and configure bucket for web serving

## Quick Deployment to GitHub Pages

```bash
# Build the site
npm run build

# Navigate to dist folder
cd dist

# Initialize git (if not already)
git init
git add .
git commit -m "Deploy dashboard"

# Push to gh-pages branch
git branch -M gh-pages
git remote add origin https://github.com/yourusername/yourrepo.git
git push -u origin gh-pages
```

Then enable GitHub Pages in your repository settings, selecting the `gh-pages` branch.

## Sharing the Built Dashboard

**Option 1: Share the entire `dist/` folder**
- Zip the `dist/` folder
- Recipient unzips and opens `index.html` in a browser
- Works offline, no server needed

**Option 2: Host on internal server**
- Copy `dist/` folder to web server directory
- Point Apache/Nginx/IIS to serve the folder
- Access via http://your-server/dashboard/

---

# Installing on Another Machine

## Step-by-Step Installation

1. **Install Node.js 18+ from https://nodejs.org/**

2. **Copy the project folder**:
   ```
   dashboard_observable/
   ```

3. **Navigate to project directory**:
   ```bash
   cd dashboard_observable
   ```

4. **Install dependencies**:
   ```bash
   npm install
   ```

   This will:
   - Download ~293 packages
   - Create `node_modules/` folder
   - Take 20-30 seconds

5. **Verify data file exists**:
   - Ensure `../plot_data.csv` is in the parent directory
   - Or update paths in `src/data/*.js` files if data location differs

6. **Build the project**:
   ```bash
   npm run build
   ```

   Success output:
   ```
   built 3 pages in src
   load /data/percentiles.json → success
   load /data/monte-carlo.csv → success
   load /data/sensitivity.json → success
   render /index → dist/index.html
   render /cashflow-risk → dist/cashflow-risk.html
   render /sensitivity → dist/sensitivity.html
   ```

7. **Run development server**:
   ```bash
   npm run dev
   ```

   Open http://localhost:3000

## Files to Copy

**Essential files**:
- `src/` folder (all markdown and data loaders)
- `observablehq.config.js`
- `package.json`
- `package-lock.json` (optional, but recommended for consistent builds)
- `../plot_data.csv` (data file in parent directory)

**Do NOT copy** (will be regenerated):
- `node_modules/` (regenerated by `npm install`)
- `dist/` (regenerated by `npm run build`)
- `src/.observablehq/cache/` (build cache)

---

# Updating Data

When `plot_data.csv` changes:

## 1. Rebuild Required

Data loaders run at **build time**, not runtime. After changing the CSV file:

```bash
npm run build
```

## 2. Clear Cache If Needed

If the build doesn't reflect your changes:

```bash
rm -rf src/.observablehq/cache
npm run build
```

On Windows:
```bash
rmdir /s /q src\.observablehq\cache
npm run build
```

## 3. Development Mode Behavior

In development mode (`npm run dev`):
- Changes to **markdown files** (`.md`) trigger automatic reload
- Changes to **data loaders** (`src/data/*.js`) require manual rebuild
- Changes to **CSV files** require manual rebuild

---

# Configuration

## Change Navigation Menu

Edit `observablehq.config.js`:

```javascript
pages: [
  {name: "Display Name", path: "/url-path"}
]
```

## Change Data File Path

Edit all files in `src/data/` (monte-carlo.csv.js, percentiles.json.js, sensitivity.json.js):

```javascript
const csvPath = join(__dirname, "../../../plot_data.csv");
```

Update the path to match your data location.

## Change Theme

Add to `observablehq.config.js`:

```javascript
theme: "dark"  // Options: "light", "dark", "air", "near-midnight"
```

## Add New Pages

1. Create `src/my-page.md`
2. Add to navigation in `observablehq.config.js`:
   ```javascript
   pages: [
     // ... existing pages
     {name: "My Page", path: "/my-page"}
   ]
   ```

## Customize Styling

Add `<style>` blocks in markdown files:

```html
<style>
  .my-class {
    color: blue;
    font-weight: bold;
  }
</style>
```

---

# Troubleshooting

## Build fails with "Cannot find package 'd3'"

**Cause**: d3 is not installed or is in wrong section of package.json

**Solution**:
- Ensure d3 is in `dependencies` (not `devDependencies`)
- Run `npm install`

## Build fails with "ENOENT: no such file or directory"

**Cause**: Data file not found at expected path

**Solution**:
- Check that `plot_data.csv` exists at `../plot_data.csv`
- Update path in all `src/data/*.js` files if data is elsewhere

## Port 3000 already in use

**Solution**:
```bash
npx observable preview --port 3001
```

## Data not updating after CSV changes

**Cause**: Data loaders run at build time, not runtime

**Solution**:
```bash
npm run build
```

## Missing root option warning

**Solution**: Add `root: "src"` to `observablehq.config.js`

## Build succeeds but pages are blank

**Cause**: JavaScript errors in markdown files or data loading issues

**Solution**:
- Open browser console (F12) to see errors
- Check that data loaders are outputting valid JSON/CSV
- Test data loaders individually: `node src/data/percentiles.json.js`

---

# Technical Info

## Project Structure

```
dashboard_observable/
├── src/                          # Source files
│   ├── index.md                  # Overview page
│   ├── cashflow-risk.md          # Cash flow risk analysis page
│   ├── sensitivity.md            # Sensitivity analysis page
│   └── data/                     # Data loaders (run at build time)
│       ├── monte-carlo.csv.js    # Processes raw CSV data
│       ├── percentiles.json.js   # Calculates percentile statistics (P1-P99)
│       └── sensitivity.json.js   # Generates Sobol sensitivity indices
├── dist/                         # Built static site (generated by npm run build)
├── node_modules/                 # NPM dependencies
├── observablehq.config.js        # Framework configuration
├── package.json                  # Node.js dependencies and scripts
└── README.md                     # This file
```

**Key files:**

`observablehq.config.js` - Framework configuration:
```javascript
export default {
  title: "Monte Carlo Simulation Dashboard",  // Browser title
  root: "src",                                 // Source directory location
  pages: [                                     // Navigation menu
    {name: "Overview", path: "/index"},
    {name: "Cash Flow Risk", path: "/cashflow-risk"},
    {name: "Sensitivity Analysis", path: "/sensitivity"}
  ],
  footer: "Built with Observable Framework"
};
```

`package.json` - Key dependencies:
- `@observablehq/framework` - Static site generator
- `d3` - Data manipulation (required for data loaders)

## Data Source

The dashboard reads from: `../plot_data.csv`

**Data format:**
```csv
# company: ACME S.p.A.
# currency: EUR
scenario,date,kpi,value
base,2025-12-31,revenue,1229488.18
Sim_00001,2025-12-31,revenue,1075378.75
...
```

**Data contents:**
- **Company**: ACME S.p.A.
- **Currency**: EUR
- **Scenarios**: base, best, worst + 50 simulation runs (Sim_00001 to Sim_00050)
- **KPIs**: revenue, ebitda, net_income
- **Years**: 2025-2028

## Data Loaders

Data loaders are Node.js scripts in `src/data/` that process data **at build time**. They run once during build, not at runtime.

**How Data Loaders Work:**

1. **Naming convention**: `[name].[format].js` produces `/data/[name].[format]`
   - Example: `percentiles.json.js` → `/data/percentiles.json`

2. **Must output to stdout**:
   ```javascript
   process.stdout.write(JSON.stringify(data));  // For JSON
   process.stdout.write(d3.csvFormat(data));    // For CSV
   ```

3. **Can use any Node.js library** (must be in dependencies)

**Available Data Loaders:**

- **monte-carlo.csv.js** - Cleans raw CSV data:
  - Removes comment lines (starting with `#`)
  - Converts values to numbers
  - Outputs cleaned CSV

- **percentiles.json.js** - Calculates statistics:
  - Groups data by date and KPI
  - Calculates percentiles: P1, P5, P10, P25, P50, P75, P90, P95, P99
  - Extracts base, best, worst scenarios
  - Outputs JSON array

- **sensitivity.json.js** - Generates sensitivity analysis:
  - Creates synthetic Sobol sensitivity indices
  - Shows which variables drive output variance
  - Outputs JSON with sensitivity and correlation data

**Testing Data Loaders:**

You can test data loaders individually:

```bash
node src/data/percentiles.json.js
node src/data/monte-carlo.csv.js
node src/data/sensitivity.json.js
```

## Pages

**1. Overview (/)**
- Summary statistics for all KPIs
- Quick view of revenue projections with fan chart
- Navigation cards to detailed analyses

**2. Cash Flow Risk (/cashflow-risk)**
- **Interactive Controls**:
  - KPI selection (revenue, EBITDA, net_income)
  - Risk threshold adjustment
- **Visualizations**:
  - Fan chart with percentile ranges (P1-P99)
  - Risk alerts when thresholds are crossed
  - Statistics cards showing P5, P10, P50, P95 values
- **Interpretation Guide**: Explains how to read the charts

**3. Sensitivity Analysis (/sensitivity)**
- **Interactive Controls**:
  - KPI and year selection
  - Top N variables slider
- **Visualizations**:
  - Tornado chart showing variable importance
  - Time-series chart of sensitivity over time
  - Correlation indicators
- **Metrics**:
  - Sensitivity % (variance explained)
  - Correlation % (direction and strength)

---

# Resources

- [Observable Framework Documentation](https://observablehq.com/framework/)
- [Observable Plot Documentation](https://observablehq.com/plot/)
- [D3 Documentation](https://d3js.org/)
- [Data Loaders Guide](https://observablehq.com/framework/loaders)
- [Inputs Reference](https://observablehq.com/framework/inputs)

---

# License

Copyright (C) 2025 Stefano Spinucci <stefano dot spinucci at gmail dot com>

This software is licensed under the PolyForm Noncommercial License 1.0.0
and may only be used for noncommercial purposes.

Commercial use, including use of the software to provide products or services
to third parties (such as consulting, SaaS, hosted or managed services),
is not permitted under the PolyForm Noncommercial License.

If you wish to use this software for commercial purposes, you must obtain
a separate commercial license by visiting https://forecastland.com
or contacting:

    forecast.land@outlook.com
